The Open Council Data platform contains two APIs. While the platform is in development (and traffic is low enough that running costs are negligible), both APIs are available unrestricted and free of charge.

Data is accessible through two APIs:

- Cloudant, for querying, including geospatial querying.
- Mapbox, for displaying directly on a map.

The data is harvested directly from councils' open data platforms, which you can discover on the [Open Council Data Map](http://map.opencouncildata.org). Councils are encouraged to publish data conforming to the [Open Council Data Standards](http://standards.opencouncildata.org/) but not all datasets are compliant. You should look to the standards to understand the meaning of fields.

### CloudAnt 

IBM's [CloudAnt](https://www.ibm.com/analytics/us/en/technology/cloud-data-services/cloudant/) is a NoSQL JSON database platform, based on [Apache CouchDB](http://couchdb.apache.org/). Being NoSQL means it is a collection of "documents" with attributes that can differ, rather than a strict table structure. (See [Cloudant Basics](https://console.bluemix.net/docs/services/Cloudant/basics/index.html#cloudant-basics).)

The Open Council Data features database contains one row (document) for every feature from every source dataset. You can:

- access all attributes and geometry for any individual feature
- use filters to find any feature with certain properties
- use spatial indexes to run queries such as "which garbage collection zone is point X within", "what are the nearest 5 childcare centers to point X" and so on.

[Cloudant query documentation](https://console.bluemix.net/docs/services/Cloudant/api/cloudant_query.html#query).

#### Basic queries

In order to run a query, you need to know the following:

* The database with all features in it is called `test`. 
* There is a [view](https://console.bluemix.net/docs/services/Cloudant/api/creating_views.html#views-mapreduce-) called `features` which returns every feature. 
* Each feature has an attribute called `topic` which contains the topic id (shown next to the name of the topic, in this platform). 
* There is an [index](https://console.bluemix.net/docs/services/Cloudant/api/design_documents.html#indexes) on that attribute, called `topics`. 

You can thus fetch all features for a topic like this:

`https://opencouncildata.cloudant.com/`**`test1`**`/_design/`**`features`**`/_search/`**`topics`**`?q=`**`topic`**`:`**_`garbage-collection-zones`_**`&include_docs=true`

This returns 25 results by default, and a `bookmark` parameter that lets you retrieve the next set of results.

The result looks like this (comments added):

```
{
  // The total number of rows available. Each row represents one feature (in this case, one garbage collection zone)
  "total_rows": 10420,
  // Passing this bookmark as a URL parameter will retrieve the next set of results, with a new bookmark.
  "bookmark": "g2wAAAABaANkAB5kYmNvcmVAZGIxMS5zbGluZy5jbG91ZGFudC5uZXRsAAAAAmJAAAAAYn____9qaAJGQABSjAAAAABhNmo",
  "rows": [
    {
      // Each feature ID is derived from the URL of the original data file, followed by a `#` and a unique number for each feature.
      "id": "http://data.gov.au/geoserver/hrcc-garbage-collection/wfs?request=GetFeature&typeName=ckan_55364505_b0f4_4006_8544_95c9ed8d11ad&outputFormat=json#10",
      // A pair of numbers generated by Cloudant for sorting. You can ignore it.
      "order": [
        2.0403060913085938,
        30
      ],
      "fields": {
        
      },
      // The "doc" is the actual contents of the row, as GeoJSON (http://geojson.org/ ) plus some additional fields.
      "doc": {
        // The feature ID again.
        "_id": "http://data.gov.au/geoserver/hrcc-garbage-collection/wfs?request=GetFeature&typeName=ckan_55364505_b0f4_4006_8544_95c9ed8d11ad&outputFormat=json#10",
        
        // The revision number of this feature. If this revision number has not changed since the last time you accessed it, the rest of the data is also unchanged. If it has changed, the data *may* have changed. See https://docs.cloudant.com/document.html .
        "_rev": "5-2b1664620091778556bdca7c88863ede",
        
        // Part of GeoJSON spec. Each row is one individual feature, so it has type "Feature".
        "type": "Feature",
        
        // The actual ID provided by the source system, in this case a CKAN identifier. (CKAN is the software that runs data.gov.au) See https://ckan.org/portfolio/metadata/
        "id": "ckan_55364505_b0f4_4006_8544_95c9ed8d11ad.11",
        
        // The part of the GeoJSON spec describing the actual location, in this case, the region in which garbage is collected on a given day.
        "geometry": {
          // Sometimes polygons are "multipolygons" because several non-contiguous areas (eg, two suburbs on opposite sides of a river) are treated as if they were one zone. Multipolygons have an extra level of array depth. See the GeoJSON spec.
          "type": "MultiPolygon",
          "coordinates": [
            [
              [
                [
                  142.15747345146423,
                  -36.67228111001598
                ],
                //...snipped...
                [
                  142.15747345146423,
                  -36.67228111001598
                ]
              ]
            ]
          ]
        },
        "geometry_name": "geom",

        // The actual relevant attributes for this feature. They should conform to the relevant standard (in this case http://standards.opencouncildata.org/#/garbage-collection-zones) but may not.
        "properties": {
          // These properties are sourced directly from the council's open dataset.
          "route": "Rural (Rubbish and Recycling)",
          "rec_day": "Thursday",
          "rec_start": "2016-05-12",
          "rub_day": "Tuesday",
          "rub_start": "2016-05-10",
          "rec_weeks": 2,
          "rub_weeks": 1,

          // This is an identifier for the council providing the data, usually the URL of the council's open data portal. Added by the Open Council Data Platform.
          "sourceCouncilId": "https://data.gov.au/organization/horsham-rural-city-council",

          // An identifier for the topic that the dataset belongs to, added by the Open Council Data Platform.
          "openCouncilDataTopic": "garbage-collection-zones"
        }
      }
    },
    // ... next feature below ...
```

#### Spatial queries
  
To find features near a given location, you can execute a spatial query, against one of the pre-defined spatial indexes.

* The `geo` view contains all the spatial indexes.
* The name of each spatial index matches the topic id.

So, for instance, to find which dog-walking zone a point at (144.356, -38.170) might be within:

`https://opencouncildata.cloudant.com/`**`test1`**`/_design/`**`geo`**`/_geo/`**`dog-walking-zones`**`?lat=`**`-38.1704`**`&lon=`**`144.356`**`&radius=0&include_docs=true`

To find any public toilets within a 1000m radius of the same point:

`https://opencouncildata.cloudant.com/`**`test1`**`/_design/`**`geo`**`/_geo/`**`public-toilets`**`?lat=`**`-38.170`**`&lon=`**`144.356`**`&radius=`**`1000`**`&include_docs=true`

For more information about queries, see the [CloudAnt documentation](https://docs.cloudant.com/search.html#query-syntax).


### Mapbox

Mapbox is a mapping platform used to create dynamic visualisations of large map datasets. Each topic has been uploaded to Mapbox as a separate [tileset](https://www.mapbox.com/help/define-tileset/), which are used to show the map previews. You could also display these tilesets on your own Mapbox maps, styled however you like. 

* Each tileset name matches its topic name, and is stored under the `opencouncildata` account. Hence, the tileset ID is `mapbox://opencouncildata.[topicname]` .
* Each tileset contains one layer, which is also the topic name.

You can use any library that can handle Mapbox vector tiles to access and display the data. That includes:

* [Mapbox-GL-JS](https://www.mapbox.com/mapbox-gl-js/api/), a WebGL library with data visualisation features for web apps.
* [Mapbox-GL Native](https://github.com/mapbox/mapbox-gl-native), libraries for native mobile and desktop apps.
* [Mapbox-GL-Leaflet](https://github.com/mapbox/mapbox-gl-leaflet), an extension to the popular Leaflet library for Mapbox vector tiles.
* [Many others](https://github.com/mapbox/awesome-vector-tiles).

#### Mapbox-GL-JS

Here is an example of adding a layer that represents public toilets, with circles, to an existing map object.

```
  map.addLayer({
    id: 'toilet-points',
    type: 'circle',
    source: {
      type: 'vector',
      url: 'mapbox://opencouncildata.public-toilets'
    },
    'source-layer': 'public-toilets',
    paint: {
      'circle-color': '#48e'
    }
  })
```

You can see a complete example is here: https://codepen.io/stevebennett/pen/RZPyqR

For more information on using Mapbox, see the [Mapbox-GL-JS API](https://www.mapbox.com/mapbox-gl-js/api/). 