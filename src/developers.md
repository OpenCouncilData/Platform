The Open Council Data platform contains two APIs. While the platform is in development (and traffic is low enough that running costs are negligible), both APIs are available unrestricted and free of charge.

Data is accessible through two APIs:

- Cloudant, for querying, including geospatial querying.
- Mapbox, for displaying directly on a map.

### CloudAnt 

IBM's [CloudAnt](https://www.ibm.com/analytics/us/en/technology/cloud-data-services/cloudant/) is a NoSQL JSON database platform, based on [Apache CouchDB](http://couchdb.apache.org/). Being NoSQL means it is a collection of "documents" with attributes that can differ, rather than a strict table structure. (See [Cloudant Basics](https://console.bluemix.net/docs/services/Cloudant/basics/index.html#cloudant-basics).)

The Open Council Data features database contains one row (document) for every feature from every source dataset. You can:

- access all attributes and geometry for any individual feature
- use filters to find any feature with certain properties
- use spatial indexes to run queries such as "which garbage collection zone is point X within", "what are the nearest 5 childcare centers to point X" and so on.

[Cloudant query documentation](https://console.bluemix.net/docs/services/Cloudant/api/cloudant_query.html#query).

#### Basic queries

You can query like this:

```
https://opencouncildata.cloudant.com/test1/_design/features/_search/topics?q=topic:garbage-collection-zones&include_docs=true
```

This returns 25 results by default, and a `bookmark` parameter that lets you retrieve the next set of results.

The result looks like this. Comments added:

```
{
  // The total number of rows available. Each row represents one feature (in this case, one garbage collection zone)
  "total_rows": 10420,
  // Passing this bookmark as a URL parameter will retrieve the next set of results, with a new bookmark.
  "bookmark": "g2wAAAABaANkAB5kYmNvcmVAZGIxMS5zbGluZy5jbG91ZGFudC5uZXRsAAAAAmJAAAAAYn____9qaAJGQABSjAAAAABhNmo",
  "rows": [
    {
      // Each feature ID is derived from the URL of the original data file, followed by a `#` and a unique number for each feature.
      "id": "http://data.gov.au/geoserver/hrcc-garbage-collection/wfs?request=GetFeature&typeName=ckan_55364505_b0f4_4006_8544_95c9ed8d11ad&outputFormat=json#10",
      // A pair of numbers generated by Cloudant for sorting. You can ignore it.
      "order": [
        2.0403060913085938,
        30
      ],
      "fields": {
        
      },
      // The "doc" is the actual contents of the row, as GeoJSON (http://geojson.org/ ) plus some additional fields.
      "doc": {
        // The feature ID again.
        "_id": "http://data.gov.au/geoserver/hrcc-garbage-collection/wfs?request=GetFeature&typeName=ckan_55364505_b0f4_4006_8544_95c9ed8d11ad&outputFormat=json#10",
        
        // The revision number of this feature. If this revision number has not changed since the last time you accessed it, the rest of the data is also unchanged. If it has changed, the data *may* have changed. See https://docs.cloudant.com/document.html .
        "_rev": "5-2b1664620091778556bdca7c88863ede",
        
        // Part of GeoJSON spec. Each row is one individual feature, so it has type "Feature".
        "type": "Feature",
        
        // The actual ID provided by the source system, in this case a CKAN identifier. (CKAN is the software that runs data.gov.au) See https://ckan.org/portfolio/metadata/
        "id": "ckan_55364505_b0f4_4006_8544_95c9ed8d11ad.11",
        
        // The part of the GeoJSON spec describing the actual location, in this case, the region in which garbage is collected on a given day.
        "geometry": {
          // Sometimes polygons are "multipolygons" because several non-contiguous areas (eg, two suburbs on opposite sides of a river) are treated as if they were one zone. Multipolygons have an extra level of array depth. See the GeoJSON spec.
          "type": "MultiPolygon",
          "coordinates": [
            [
              [
                [
                  142.15747345146423,
                  -36.67228111001598
                ],
                //...snipped...
                [
                  142.15747345146423,
                  -36.67228111001598
                ]
              ]
            ]
          ]
        },
        "geometry_name": "geom",

        // The actual relevant attributes for this feature. They should conform to the relevant standard (in this case http://standards.opencouncildata.org/#/garbage-collection-zones) but may not.
        "properties": {
          // These properties are sourced directly from the council's open dataset.
          "route": "Rural (Rubbish and Recycling)",
          "rec_day": "Thursday",
          "rec_start": "2016-05-12",
          "rub_day": "Tuesday",
          "rub_start": "2016-05-10",
          "rec_weeks": 2,
          "rub_weeks": 1,

          // This is an identifier for the council providing the data, usually the URL of the council's open data portal. Added by the Open Council Data Platform.
          "sourceCouncilId": "https://data.gov.au/organization/horsham-rural-city-council",

          // An identifier for the topic that the dataset belongs to, added by the Open Council Data Platform.
          "openCouncilDataTopic": "garbage-collection-zones"
        }
      }
    },
    // ... next feature below ...
```

#### Spatial queries
  
Very often, you will want to find 

Find which dog walking zone a point is in:

```
  https://opencouncildata.cloudant.com/test1/_design/geo/_geo/dog-geo?lat=-38.17046&lon=144.35649&radius=0&include_docs=true
```


For more information about queries, see the [CloudAnt documentation](https://docs.cloudant.com/search.html#query-syntax).


### Mapbox

Mapbox is a mapping platform used to create dynamic visualisations of large map datasets. Each topic has been uploaded to Mapbox as a separate [tileset](https://www.mapbox.com/help/define-tileset/), which are used to show the map previews. You could also display these tilesets on your own Mapbox maps, styled however you like. 

Each tileset name matches its topic name, and is stored under the `opencouncildata` account. Hence, the tileset ID is `mapbox://opencouncildata.[topicname]` .

Each tileset contains one layer, which is also the topic name.

For example, to add a layer of circles representing public toilets:

```
  map.addLayer({
    id: 'toilet-points',
    type: 'circle',
    source: {
      type: 'vector',
      url: 'mapbox://opencouncildata.public-toilets'
    },
    'source-layer': 'public-toilets',
    paint: {
      'circle-color': '#48e'
    }
  })
```

A complete example is here: https://codepen.io/stevebennett/pen/RZPyqR